<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for ./js/module/submitRegistration.js</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../../prettify.css">
    <link rel="stylesheet" href="../../base.css">
    <style type='text/css'>
        div.coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class="header medium">
    <h1>Code coverage report for <span class="entity">./js/module/submitRegistration.js</span></h1>
    <h2>
        Statements: <span class="metric">55.17% <small>(16 / 29)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Branches: <span class="metric">42.86% <small>(6 / 14)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Functions: <span class="metric">75% <small>(6 / 8)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Lines: <span class="metric">55.17% <small>(16 / 29)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../index.html">All files</a> &#187; <a href="index.html">./js/module/</a> &#187; submitRegistration.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94</td><td class="line-coverage"><span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12</span>
<span class="cline-any cline-yes">12</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">define(["service/data", "templates/error", "service/window"], function (dataService, templateError, windowService) {
	"use strict";
&nbsp;
	var privateMembers = {
			"error": {
				"informationLost": "Sorry, we could not process your information.  We would love for you to attend this years Ohio Men's Ox Roast And Retreat, so please try again later or contact us at info@ohiomensoxroast.org and we can do your registration for you."
			},
			"unwantedDataFields": ["guest_firstname", "guest_lastname"]
		},
		publicMembers = {
			"bindEvents": <span class="fstat-no" title="function not covered" >function (settings) {</span>
<span class="cstat-no" title="statement not covered" >				$(document).on("submit", settings.scope, publicMembers.submitForm);</span>
			},
			"submitForm": function(event) {
				event.preventDefault();
&nbsp;
				var form = $(event.target),
					isFormValid = form.valid(),
					formAction = form.attr("action"),
					serializedForm = dataService.serializeToObject(form),
					preparedFormData = publicMembers.prepareDataForSubmission(serializedForm, privateMembers.unwantedDataFields),
					uniqueDataKey = publicMembers.addDataToDatabase(preparedFormData, "https://shining-heat-3928.firebaseio.com/oxroast/registration/2016"); //should only be done if we know the form is at leas valid
&nbsp;
&nbsp;
				//if form is valid
				$.ajax({
					type: "POST",
	                url: formAction,
	                data: preparedFormData,
	                dataType: "json"
				}).done(function(data) {
					//if this comes back as successful then redirect other wise remove data from Firebase
	                publicMembers.redirectUserToCompletePayment(data, uniqueDataKey);
	            });
			},
			"prepareDataForSubmission": <span class="fstat-no" title="function not covered" >function (data, removeData) {</span>
<span class="cstat-no" title="statement not covered" >				var guestList = JSON.parse(data.guestList),</span>
					index = 0,
					fieldToRemove = null;
&nbsp;
<span class="cstat-no" title="statement not covered" >				data.guests = guestList.guest;</span>
<span class="cstat-no" title="statement not covered" >				delete data.guestList;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >				if (removeData &amp;&amp; removeData.length &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >					index = removeData.length - 1;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >					for (; index &gt;= 0; index -= 1) {</span>
<span class="cstat-no" title="statement not covered" >						fieldToRemove = removeData[index];</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >						delete data[fieldToRemove];</span>
					}
				}
&nbsp;
<span class="cstat-no" title="statement not covered" >				return data;</span>
			},
			"addDataToDatabase": function (data, dbRef) {
				var noSQLDBReference = null,
					databaseKey = null;
&nbsp;
				<span class="missing-if-branch" title="else path not taken" >E</span>if (data &amp;&amp; dbRef) {
					noSQLDBReference = dataService.getReference(dbRef),
					databaseKey = dataService.set(noSQLDBReference, data);
				} else {
<span class="cstat-no" title="statement not covered" >					publicMembers.processError({</span>
						"errorMessage": privateMembers.error.informationLost
					});
				}
&nbsp;
				return databaseKey;
			},
			"redirectUserToCompletePayment": function (data, uniqueDataKey) {
				var redirectUrl = null;
&nbsp;
				<span class="missing-if-branch" title="if path not taken" >I</span>if (data &amp;&amp; data.redirectUrl &amp;&amp; <span class="branch-2 cbranch-no" title="branch not covered" >typeof data.redirectUrl === "string" </span>&amp;&amp; <span class="branch-3 cbranch-no" title="branch not covered" >uniqueDataKey)</span> {
					//redirectUrl = data.redirectUrl + "&amp;item_number=" + uniqueDataKey;
<span class="cstat-no" title="statement not covered" >					redirectUrl = data.redirectUrl + "&amp;useraction=commit";</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >					windowService.redirect(redirectUrl);</span>
				} else {
					publicMembers.processError({
						"errorMessage": privateMembers.error.informationLost
					});
				}
			},
			"processError": function (data) {
				var markup = templateError.error(data);
&nbsp;
				$("#registration-form &gt; fieldset:first-of-type").prepend(markup);
			},
&nbsp;
		};
&nbsp;
	return publicMembers;
});</pre></td></tr>
</table></pre>

</div>
<div class="footer">
    <div class="meta">Generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu Mar 31 2016 19:48:31 GMT-0400 (Eastern Daylight Time)</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
